#!/bin/sh

set -eu

mkfifo /tmp/mywmenu_in /tmp/mywmenu_out
trap 'rm -rf /tmp/mywmenu_in /tmp/mywmenu_out; trap - EXIT; exit' EXIT INT HUP

_terminal() {
  footclient -a mywmenu sh -c "$@" &
}

_wmenu() {
  _prompt="$1"
  eval "_terminal 'fzf --prompt \"${_prompt}\" < /tmp/mywmenu_in > /tmp/mywmenu_out'"
  cat > /tmp/mywmenu_in
  cat /tmp/mywmenu_out
}

_notes() {
  _f="$(cd "${HOME}/b/notes" && fd -t f | _wmenu 'Notes > ')"
  test -n "${_f}" && _terminal "kak ${HOME}/b/notes/${_f}"
}

_choices="
notes
apk_upgrade
mridangam_attendance
firefox
keepassxc
signal
"

case "$(echo ${_choices} | xargs -n1 | _wmenu 'SIVA > ')" in
  notes) _notes ;;
  apk_upgrade)
    _terminal 'doas apk upgrade && echo "SIVA: system upgraded, press enter to exit..." && read'
    ;;
  mridangam_attendance)
    _terminal "cd ${HOME}/b/notes/mridangam && kak mridangam_class_2026.txt"
    ;;
  firefox) firefox & ;;
  keepassxc) keepassxc & ;;
  signal) signal-desktop & ;;
  *) exit 1 ;;
esac
